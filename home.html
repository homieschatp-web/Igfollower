<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CHEAPEST IG SERVICE | Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --neon: #00f2fe; --dark: #020617; --tg: #24A1DE; --help: #22c55e; }
        body { 
            background: var(--dark); color: #e2e8f0; font-family: 'Poppins', sans-serif; 
            background: radial-gradient(circle at 50% 0%, #001a33 0%, #020617 100%);
            min-height: 100vh; overflow-x: hidden;
        }
        .orbitron { font-family: 'Orbitron', sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .inner-card { background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(0, 242, 254, 0.1); }
        
        /* Sidebar System */
        .sidebar { transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); z-index: 1000; }
        .sidebar.closed { transform: translateX(-100%); }
        
        /* Overlay UI */
        .overlay-container { position: fixed; bottom: 25px; right: 20px; display: flex; flex-direction: column; gap: 12px; z-index: 999; }
        .overlay-btn { width: 56px; height: 56px; border-radius: 50%; display: flex; items-center: center; justify-content: center; box-shadow: 0 8px 20px rgba(0,0,0,0.4); transition: 0.3s; }
        
        /* Tab Styling */
        .tab-btn { font-size: 9px; padding: 10px; border-bottom: 2px solid transparent; transition: 0.3s; color: #64748b; }
        .tab-btn.active { color: var(--neon); border-color: var(--neon); }

        .status-pill { font-size: 7px; padding: 2px 8px; border-radius: 99px; font-weight: bold; text-transform: uppercase; }
        .status-open { background: rgba(34, 197, 94, 0.1); color: #22c55e; }
        .status-closed { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

        .custom-scroll::-webkit-scrollbar { width: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: var(--neon); border-radius: 10px; }
        
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); } 70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }
        .pulse-green { animation: pulse 2s infinite; }
    </style>
</head>
<body class="flex flex-col">

    <div class="overlay-container">
        <a href="https://t.me/Asiawalatech" target="_blank" class="overlay-btn bg-[#24A1DE] active:scale-90 flex items-center justify-center">
            <svg class="w-7 h-7 text-white" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm4.467 8.246c.14 1.274-.1 3.972-.247 5.242-.125 1.07-.47 1.408-.856 1.447-.838.083-1.474-.547-2.284-1.077-1.268-.83-1.984-1.345-3.216-2.155-1.423-.935-.5-1.448.31-2.29.212-.22 3.896-3.574 3.968-3.88.009-.038.017-.18-.056-.244-.073-.064-.181-.043-.259-.025-.11.024-1.867 1.186-5.263 3.473-.497.34-.947.508-1.35.501-.444-.007-1.298-.248-1.933-.454-.78-.252-1.398-.387-1.343-.817.029-.224.335-.453.918-.687 3.6-1.568 5.999-2.603 7.198-3.104 3.426-1.433 4.138-1.682 4.602-1.69.102-.002.329.023.476.143.123.1.158.234.17.344.012.11.025.377.014.52z"/></svg>
        </a>
        <button onclick="toggleSidebar()" class="overlay-btn bg-[#22c55e] pulse-green active:scale-90 flex items-center justify-center">
            <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>
        </button>
    </div>

    <header class="p-5 flex justify-between items-center sticky top-0 z-[900] glass border-b border-white/5">
        <button onclick="toggleSidebar()" class="p-2 glass rounded-xl text-cyan-400">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
        </button>
        <div class="text-center">
            <h1 class="orbitron text-[11px] font-bold text-white tracking-widest uppercase">CHEAPEST IG SERVICE</h1>
            <p class="text-[7px] orbitron text-cyan-500 uppercase">Secure_Marketplace</p>
        </div>
        <div class="w-10"></div>
    </header>

    <aside id="sidebar" class="sidebar fixed top-0 left-0 h-full w-80 glass border-r border-white/10 p-6 closed flex flex-col">
        <div class="flex justify-between items-center mb-6">
            <h2 class="orbitron text-[10px] text-cyan-400 font-bold uppercase">User Dashboard</h2>
            <button onclick="toggleSidebar()" class="text-slate-500 text-xl">✕</button>
        </div>

        <div class="flex border-b border-white/5 mb-4">
            <button onclick="switchTab('orders')" id="tab-orders" class="tab-btn flex-1 orbitron active">Orders</button>
            <button onclick="switchTab('tickets')" id="tab-tickets" class="tab-btn flex-1 orbitron">Support</button>
        </div>

        <div id="view-orders" class="flex-1 overflow-y-auto custom-scroll space-y-3">
             <div id="history-list"></div>
        </div>

        <div id="view-tickets" class="hidden flex-1 flex flex-col overflow-hidden">
            <div id="ticket-form" class="mb-4 p-3 inner-card rounded-xl">
                <input id="t-orderid" type="text" placeholder="Order ID (Optional)" class="w-full bg-transparent text-[10px] text-white border-b border-white/10 mb-2 focus:outline-none">
                <textarea id="t-msg" rows="2" placeholder="Issue description..." class="w-full bg-transparent text-[10px] text-white border-b border-white/10 focus:outline-none"></textarea>
                <button onclick="submitTicket()" id="t-btn" class="w-full mt-2 py-2 bg-cyan-500 text-black rounded-lg orbitron text-[8px] font-bold">OPEN TICKET</button>
            </div>

            <div id="chat-window" class="hidden flex-1 flex flex-col bg-black/40 rounded-xl border border-white/10 mb-3 overflow-hidden">
                <div class="p-2 bg-white/5 border-b border-white/10 flex justify-between items-center">
                    <span id="chat-title" class="text-[8px] orbitron text-cyan-400">TICKET_CHAT</span>
                    <button onclick="closeChat()" class="text-[9px] text-slate-500">Back</button>
                </div>
                <div id="chat-messages" class="flex-1 overflow-y-auto p-3 space-y-2 custom-scroll flex flex-col"></div>
                <div class="p-2 border-t border-white/10 flex gap-2">
                    <input id="chat-input" type="text" placeholder="Type reply..." class="flex-1 bg-transparent text-[10px] text-white outline-none">
                    <button onclick="sendReply()" class="text-cyan-400 text-[10px] font-bold">SEND</button>
                </div>
            </div>

            <div id="ticket-list" class="flex-1 overflow-y-auto custom-scroll space-y-3"></div>
        </div>

        <div class="pt-4 border-t border-white/5 mt-4">
            <div class="flex justify-between items-center mb-4 px-1">
                <span class="orbitron text-[8px] text-slate-500">INVESTED</span>
                <span id="total-spend" class="orbitron text-sm font-bold text-white tracking-tighter">₹0</span>
            </div>
            <button onclick="logout()" class="w-full py-2 text-red-500/40 orbitron text-[8px] font-bold">TERMINATE SESSION</button>
        </div>
    </aside>

    <main class="p-5 max-w-lg mx-auto pb-32">
        <div id="service-grid" class="space-y-6">
            </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, where, serverTimestamp, doc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyCoVj4nvQJULBMD_KYpGfRWi4npme6RNnM", 
            authDomain: "mms-f37cf.firebaseapp.com", 
            projectId: "mms-f37cf", 
            storageBucket: "mms-f37cf.firebasestorage.app", 
            messagingSenderId: "85615411698", 
            appId: "1:85615411698:web:ab25f02dac6efa1e6eeb6b" 
        };
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let userEmail = null;
        let activeTicketId = null;

        onAuthStateChanged(auth, u => {
            if(!u) window.location.href = "index.html";
            userEmail = u.email;
            initMarket();
        });

        window.toggleSidebar = () => document.getElementById('sidebar').classList.toggle('closed');
        
        window.switchTab = (tab) => {
            document.getElementById('view-orders').classList.toggle('hidden', tab !== 'orders');
            document.getElementById('view-tickets').classList.toggle('hidden', tab !== 'tickets');
            document.getElementById('tab-orders').classList.toggle('active', tab === 'orders');
            document.getElementById('tab-tickets').classList.toggle('active', tab === 'tickets');
        };

        // Ticket Logic
        window.submitTicket = async () => {
            const msg = document.getElementById('t-msg').value;
            const orderId = document.getElementById('t-orderid').value || "General";
            if(!msg) return alert("Enter message");
            await addDoc(collection(db, "tickets"), {
                userEmail, orderId, status: "Open", createdAt: serverTimestamp(), lastMessage: serverTimestamp(),
                messages: [{ sender: "user", text: msg, time: Date.now() }]
            });
            document.getElementById('t-msg').value = "";
            alert("Support ticket created!");
        };

        window.openTicketChat = (id, orderId) => {
            activeTicketId = id;
            document.getElementById('ticket-form').classList.add('hidden');
            document.getElementById('ticket-list').classList.add('hidden');
            document.getElementById('chat-window').classList.remove('hidden');
            document.getElementById('chat-title').innerText = `ID: ${orderId}`;
            loadChat(id);
        };

        window.closeChat = () => {
            activeTicketId = null;
            document.getElementById('ticket-form').classList.remove('hidden');
            document.getElementById('ticket-list').classList.remove('hidden');
            document.getElementById('chat-window').classList.add('hidden');
        };

        window.sendReply = async () => {
            const text = document.getElementById('chat-input').value;
            if(!text || !activeTicketId) return;
            await updateDoc(doc(db, "tickets", activeTicketId), {
                messages: arrayUnion({ sender: "user", text, time: Date.now() }),
                lastMessage: serverTimestamp()
            });
            document.getElementById('chat-input').value = "";
        };

        function loadChat(id) {
            onSnapshot(doc(db, "tickets", id), docSnap => {
                if(!docSnap.exists()) return;
                const container = document.getElementById('chat-messages');
                container.innerHTML = "";
                docSnap.data().messages.forEach(m => {
                    const isUser = m.sender === "user";
                    container.innerHTML += `
                    <div class="max-w-[85%] ${isUser ? 'self-end bg-cyan-600 text-black' : 'self-start bg-white/10 text-white'} p-2 rounded-xl text-[10px]">
                        <p>${m.text}</p>
                    </div>`;
                });
                container.scrollTop = container.scrollHeight;
            });
        }

        function initMarket() {
            // Load Services (Marketplace)
            onSnapshot(query(collection(db, "services"), orderBy("quantity", "asc")), snap => {
                const grid = document.getElementById('service-grid');
                grid.innerHTML = "";
                snap.forEach(d => {
                    const s = d.data();
                    grid.innerHTML += `
                    <div class="glass p-6 rounded-[2.5rem] border border-white/5">
                        <div class="flex justify-between items-start mb-6 px-1">
                            <div>
                                <p class="orbitron text-[8px] text-cyan-400 mb-1 uppercase tracking-widest">${s.name}</p>
                                <h3 class="text-4xl font-bold tracking-tighter">${s.quantity.toLocaleString()}</h3>
                                <p class="text-[9px] text-slate-500 font-bold orbitron uppercase">Followers_Unit</p>
                            </div>
                            <div class="w-12 h-12 glass rounded-2xl flex items-center justify-center text-cyan-400">
                                 <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                            </div>
                        </div>
                        <div class="inner-card p-4 rounded-[1.8rem] flex justify-between items-center border border-white/5">
                            <div><p class="text-[8px] orbitron text-slate-500">COST</p><span class="text-xl font-bold text-white tracking-tighter">₹${s.price}</span></div>
                            <a href="order.html?id=${d.id}" class="bg-cyan-500 text-black px-8 py-3 rounded-2xl orbitron text-[10px] font-bold shadow-lg shadow-cyan-500/20 active:scale-95 transition-all">BUY_NOW</a>
                        </div>
                    </div>`;
                });
            });

            // Load History (Synced to User Email)
            onSnapshot(query(collection(db, "orders"), where("userEmail", "==", userEmail), orderBy("createdAt", "desc")), snap => {
                const list = document.getElementById('history-list');
                const spendEl = document.getElementById('total-spend');
                let total = 0; list.innerHTML = "";
                snap.forEach(doc => {
                    const o = doc.data(); total += Number(o.price || 0);
                    list.innerHTML += `
                    <div class="p-3 bg-white/5 rounded-xl border border-white/5 mb-2">
                        <div class="flex justify-between text-[7px] orbitron mb-1"><span class="text-white/30">${o.orderId}</span><span class="${o.status === 'Success' ? 'text-green-400' : 'text-yellow-400'}">${o.status}</span></div>
                        <p class="text-[10px] font-bold text-white/80 uppercase tracking-tight">${o.tierName}</p>
                        <p class="text-[9px] text-cyan-400">₹${o.price}</p>
                    </div>`;
                });
                spendEl.innerText = `₹${total}`;
            });

            // Load Tickets List
            onSnapshot(query(collection(db, "tickets"), where("userEmail", "==", userEmail), orderBy("lastMessage", "desc")), snap => {
                const list = document.getElementById('ticket-list');
                list.innerHTML = "";
                snap.forEach(docSnap => {
                    const t = docSnap.data();
                    list.innerHTML += `
                    <div onclick="openTicketChat('${docSnap.id}', '${t.orderId}')" class="p-3 bg-white/5 rounded-xl border border-white/5 cursor-pointer hover:bg-white/10 transition">
                        <div class="flex justify-between items-center mb-1">
                            <span class="orbitron text-[7px] text-white/20">ID: ${t.orderId}</span>
                            <span class="status-pill ${t.status === 'Open' ? 'status-open' : 'status-closed'}">${t.status}</span>
                        </div>
                        <p class="text-[9px] text-white/60 truncate">${t.messages[t.messages.length - 1].text}</p>
                    </div>`;
                });
            });
        }

        window.logout = () => signOut(auth).then(() => location.href="index.html");
    </script>
</body>
    </html>
    
